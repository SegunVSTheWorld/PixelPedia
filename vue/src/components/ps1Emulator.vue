<template>
  <body>
    <div class="floating-div">
    <div class="floating-buttons">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fvignette2.wikia.nocookie.net%2Fspecops%2Fimages%2F2%2F2f%2FPS_X.png%2Frevision%2Flatest%3Fcb%3D20120105182549&f=1&nofb=1&ipt=e628257f43735adc75a7383a294de255636004abb4cc1c6cf4ecf8a1a5abb8ab&ipo=images" class="floating-button" id="btn-x">
    <img src="https://www.videogameshelf.com/wp-content/uploads/2013/02/PlayStation-Circle.png" class="floating-button" id="btn-o">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/PlayStationTriangle.svg/1229px-PlayStationTriangle.svg.png" class="floating-button" id="btn-triangle">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F4%2F42%2FPlayStationSquare.svg%2F1229px-PlayStationSquare.svg.png&f=1&nofb=1&ipt=9b7870febc90cae6a7d0c189ff443567fd6c268b81c6b297b24aaf53cbe80abb&ipo=images" class="floating-button" id="btn-square">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fvignette2.wikia.nocookie.net%2Fspecops%2Fimages%2F2%2F2f%2FPS_X.png%2Frevision%2Flatest%3Fcb%3D20120105182549&f=1&nofb=1&ipt=e628257f43735adc75a7383a294de255636004abb4cc1c6cf4ecf8a1a5abb8ab&ipo=images" class="floating-button" id="btn-x">
    <img src="https://www.videogameshelf.com/wp-content/uploads/2013/02/PlayStation-Circle.png" class="floating-button" id="btn-o">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/PlayStationTriangle.svg/1229px-PlayStationTriangle.svg.png" class="floating-button" id="btn-triangle">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F4%2F42%2FPlayStationSquare.svg%2F1229px-PlayStationSquare.svg.png&f=1&nofb=1&ipt=9b7870febc90cae6a7d0c189ff443567fd6c268b81c6b297b24aaf53cbe80abb&ipo=images" class="floating-button" id="btn-square">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fvignette2.wikia.nocookie.net%2Fspecops%2Fimages%2F2%2F2f%2FPS_X.png%2Frevision%2Flatest%3Fcb%3D20120105182549&f=1&nofb=1&ipt=e628257f43735adc75a7383a294de255636004abb4cc1c6cf4ecf8a1a5abb8ab&ipo=images" class="floating-button" id="btn-x">
    <img src="https://www.videogameshelf.com/wp-content/uploads/2013/02/PlayStation-Circle.png" class="floating-button" id="btn-o">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/PlayStationTriangle.svg/1229px-PlayStationTriangle.svg.png" class="floating-button" id="btn-triangle">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F4%2F42%2FPlayStationSquare.svg%2F1229px-PlayStationSquare.svg.png&f=1&nofb=1&ipt=9b7870febc90cae6a7d0c189ff443567fd6c268b81c6b297b24aaf53cbe80abb&ipo=images" class="floating-button" id="btn-square">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fvignette2.wikia.nocookie.net%2Fspecops%2Fimages%2F2%2F2f%2FPS_X.png%2Frevision%2Flatest%3Fcb%3D20120105182549&f=1&nofb=1&ipt=e628257f43735adc75a7383a294de255636004abb4cc1c6cf4ecf8a1a5abb8ab&ipo=images" class="floating-button" id="btn-x">
    <img src="https://www.videogameshelf.com/wp-content/uploads/2013/02/PlayStation-Circle.png" class="floating-button" id="btn-o">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/PlayStationTriangle.svg/1229px-PlayStationTriangle.svg.png" class="floating-button" id="btn-triangle">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F4%2F42%2FPlayStationSquare.svg%2F1229px-PlayStationSquare.svg.png&f=1&nofb=1&ipt=9b7870febc90cae6a7d0c189ff443567fd6c268b81c6b297b24aaf53cbe80abb&ipo=images" class="floating-button" id="btn-square">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fvignette2.wikia.nocookie.net%2Fspecops%2Fimages%2F2%2F2f%2FPS_X.png%2Frevision%2Flatest%3Fcb%3D20120105182549&f=1&nofb=1&ipt=e628257f43735adc75a7383a294de255636004abb4cc1c6cf4ecf8a1a5abb8ab&ipo=images" class="floating-button" id="btn-x">
    <img src="https://www.videogameshelf.com/wp-content/uploads/2013/02/PlayStation-Circle.png" class="floating-button" id="btn-o">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/PlayStationTriangle.svg/1229px-PlayStationTriangle.svg.png" class="floating-button" id="btn-triangle">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F4%2F42%2FPlayStationSquare.svg%2F1229px-PlayStationSquare.svg.png&f=1&nofb=1&ipt=9b7870febc90cae6a7d0c189ff443567fd6c268b81c6b297b24aaf53cbe80abb&ipo=images" class="floating-button" id="btn-square">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fvignette2.wikia.nocookie.net%2Fspecops%2Fimages%2F2%2F2f%2FPS_X.png%2Frevision%2Flatest%3Fcb%3D20120105182549&f=1&nofb=1&ipt=e628257f43735adc75a7383a294de255636004abb4cc1c6cf4ecf8a1a5abb8ab&ipo=images" class="floating-button" id="btn-x">
    <img src="https://www.videogameshelf.com/wp-content/uploads/2013/02/PlayStation-Circle.png" class="floating-button" id="btn-o">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/PlayStationTriangle.svg/1229px-PlayStationTriangle.svg.png" class="floating-button" id="btn-triangle">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F4%2F42%2FPlayStationSquare.svg%2F1229px-PlayStationSquare.svg.png&f=1&nofb=1&ipt=9b7870febc90cae6a7d0c189ff443567fd6c268b81c6b297b24aaf53cbe80abb&ipo=images" class="floating-button" id="btn-square">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fvignette2.wikia.nocookie.net%2Fspecops%2Fimages%2F2%2F2f%2FPS_X.png%2Frevision%2Flatest%3Fcb%3D20120105182549&f=1&nofb=1&ipt=e628257f43735adc75a7383a294de255636004abb4cc1c6cf4ecf8a1a5abb8ab&ipo=images" class="floating-button" id="btn-x">
    <img src="https://www.videogameshelf.com/wp-content/uploads/2013/02/PlayStation-Circle.png" class="floating-button" id="btn-o">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/PlayStationTriangle.svg/1229px-PlayStationTriangle.svg.png" class="floating-button" id="btn-triangle">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F4%2F42%2FPlayStationSquare.svg%2F1229px-PlayStationSquare.svg.png&f=1&nofb=1&ipt=9b7870febc90cae6a7d0c189ff443567fd6c268b81c6b297b24aaf53cbe80abb&ipo=images" class="floating-button" id="btn-square">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fvignette2.wikia.nocookie.net%2Fspecops%2Fimages%2F2%2F2f%2FPS_X.png%2Frevision%2Flatest%3Fcb%3D20120105182549&f=1&nofb=1&ipt=e628257f43735adc75a7383a294de255636004abb4cc1c6cf4ecf8a1a5abb8ab&ipo=images" class="floating-button" id="btn-x">
    <img src="https://www.videogameshelf.com/wp-content/uploads/2013/02/PlayStation-Circle.png" class="floating-button" id="btn-o">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/PlayStationTriangle.svg/1229px-PlayStationTriangle.svg.png" class="floating-button" id="btn-triangle">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F4%2F42%2FPlayStationSquare.svg%2F1229px-PlayStationSquare.svg.png&f=1&nofb=1&ipt=9b7870febc90cae6a7d0c189ff443567fd6c268b81c6b297b24aaf53cbe80abb&ipo=images" class="floating-button" id="btn-square">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fvignette2.wikia.nocookie.net%2Fspecops%2Fimages%2F2%2F2f%2FPS_X.png%2Frevision%2Flatest%3Fcb%3D20120105182549&f=1&nofb=1&ipt=e628257f43735adc75a7383a294de255636004abb4cc1c6cf4ecf8a1a5abb8ab&ipo=images" class="floating-button" id="btn-x">
    <img src="https://www.videogameshelf.com/wp-content/uploads/2013/02/PlayStation-Circle.png" class="floating-button" id="btn-o">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/PlayStationTriangle.svg/1229px-PlayStationTriangle.svg.png" class="floating-button" id="btn-triangle">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F4%2F42%2FPlayStationSquare.svg%2F1229px-PlayStationSquare.svg.png&f=1&nofb=1&ipt=9b7870febc90cae6a7d0c189ff443567fd6c268b81c6b297b24aaf53cbe80abb&ipo=images" class="floating-button" id="btn-square">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fvignette2.wikia.nocookie.net%2Fspecops%2Fimages%2F2%2F2f%2FPS_X.png%2Frevision%2Flatest%3Fcb%3D20120105182549&f=1&nofb=1&ipt=e628257f43735adc75a7383a294de255636004abb4cc1c6cf4ecf8a1a5abb8ab&ipo=images" class="floating-button" id="btn-x">
    <img src="https://www.videogameshelf.com/wp-content/uploads/2013/02/PlayStation-Circle.png" class="floating-button" id="btn-o">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/PlayStationTriangle.svg/1229px-PlayStationTriangle.svg.png" class="floating-button" id="btn-triangle">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F4%2F42%2FPlayStationSquare.svg%2F1229px-PlayStationSquare.svg.png&f=1&nofb=1&ipt=9b7870febc90cae6a7d0c189ff443567fd6c268b81c6b297b24aaf53cbe80abb&ipo=images" class="floating-button" id="btn-square">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fvignette2.wikia.nocookie.net%2Fspecops%2Fimages%2F2%2F2f%2FPS_X.png%2Frevision%2Flatest%3Fcb%3D20120105182549&f=1&nofb=1&ipt=e628257f43735adc75a7383a294de255636004abb4cc1c6cf4ecf8a1a5abb8ab&ipo=images" class="floating-button" id="btn-x">
    <img src="https://www.videogameshelf.com/wp-content/uploads/2013/02/PlayStation-Circle.png" class="floating-button" id="btn-o">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/PlayStationTriangle.svg/1229px-PlayStationTriangle.svg.png" class="floating-button" id="btn-triangle">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F4%2F42%2FPlayStationSquare.svg%2F1229px-PlayStationSquare.svg.png&f=1&nofb=1&ipt=9b7870febc90cae6a7d0c189ff443567fd6c268b81c6b297b24aaf53cbe80abb&ipo=images" class="floating-button" id="btn-square">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fvignette2.wikia.nocookie.net%2Fspecops%2Fimages%2F2%2F2f%2FPS_X.png%2Frevision%2Flatest%3Fcb%3D20120105182549&f=1&nofb=1&ipt=e628257f43735adc75a7383a294de255636004abb4cc1c6cf4ecf8a1a5abb8ab&ipo=images" class="floating-button" id="btn-x">
    <img src="https://www.videogameshelf.com/wp-content/uploads/2013/02/PlayStation-Circle.png" class="floating-button" id="btn-o">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/PlayStationTriangle.svg/1229px-PlayStationTriangle.svg.png" class="floating-button" id="btn-triangle">
    <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F4%2F42%2FPlayStationSquare.svg%2F1229px-PlayStationSquare.svg.png&f=1&nofb=1&ipt=9b7870febc90cae6a7d0c189ff443567fd6c268b81c6b297b24aaf53cbe80abb&ipo=images" class="floating-button" id="btn-square">
    </div>
</div>
      <div>
      <div id="ps1Screen">
      <wasmpsx-player ref="wasmpsxElement" class="screen"></wasmpsx-player>
      <div>
      <video ref="intro" class="intro" v-show="intro" width="640" height="480" @ended="startEmulator"><source src="@/assets/bootScreen/ps1Boot.mp4" type="video/mp4"></video>
      </div>
      </div>
      <div class='overlay-Div'>
        <img id="ps1overlayOn" src="https://forums.libretro.com/uploads/default/optimized/2X/b/bf3b432e28763ba01f867a42ce62b56c27c96971_2_1035x582.png" v-show="running">
        <img id="ps1overlayOff" src="@/assets/bootScreen/ps1overlay.png" v-show="!running">
          <div class="button-Div">
            <button class="overlay-button" id="power" @click="playIntro">POWER</button>
            <input type="file" ref="gameInput" style="display:none;"/>
            <button class="overlay-button" id="load" @click="triggerFileInput">OPEN</button>  
          </div>
    </div>
      <div>
      <span id="tagline"> "Live in your world. Play in ours."</span> 
      </div>
    <div id="sony-Div">
      <img class="sony" src="https://pngimg.com/uploads/sony_playstation/sony_playstation_PNG17532.png">
    </div>
    <div id="message">
      <p class="tips" style="color: #DF0024">Playstations better with a controller....</p>
      <p class="tips" style="color: #F3C300">To play, plugin a controller and tap a button</p>
      <p class="tips" style="color: #00AC9F">Your controller will auto-connect</p>
      <p class="tips" style="color: #00AC9F">Press the OPEN button to load a game</p>
      <p class="tips" style="color: #2E6DB4">Press POWER to expereince some nostalgia</p>
      <p class="tips" style="color: #2E6DB4">-sincerely, PIXELPEDIA...</p>
    </div>
      </div>
  </body>
</template>

<script>
export default {
  name: "ps1Emulator",
  data() {
    return {
      emulatorScript: null,
      running: false,
      intro: true,
    };
  },
  beforeCreate() {
    window.Module = {
      locateFile: function (filename) {
        if (filename.endsWith(".wasm")) {
          return "/wasmpsx-master/wasmpsx_ww.wasm";
        }
        return filename;
      },
    };

    if (
      !document.querySelector('script[src="/wasmpsx-master/wasmpsx.min.js"]')
    ) {
      this.emulatorScript = document.createElement("script");
      this.emulatorScript.src = "/wasmpsx-master/wasmpsx.min.js";
      document.head.appendChild(this.emulatorScript);
    }
  },
  mounted() {
    const buttons = document.querySelectorAll(".floating-button");

    function randomBetween(min, max) {
      return Math.random() * (max - min) + min;
    }

    function setRandomStartPosition(button) {
    button.style.left = randomBetween(0, 90) + "%";
    button.style.top = "-60px";
    button.rotationAngle = Math.random() * 360;
    button.style.transform = `rotate(${button.rotationAngle}deg)`;
    button.style.opacity = "1";
}
    function moveButtonDown(button) {
    let currentTop = parseFloat(button.style.top || 0);
    currentTop += 1;
    let distanceFromBottom = window.innerHeight - (currentTop + button.offsetHeight);
    let opacity = distanceFromBottom / window.innerHeight;
    opacity = Math.max(0, Math.min(1, opacity));
    button.style.opacity = opacity;
    if (distanceFromBottom <= 30) {
        setRandomStartPosition(button);
    } else {
        button.style.top = currentTop + "px";
    }
    button.rotationAngle += 0.4;
    button.style.transform = `rotate(${button.rotationAngle}deg)`;
}
    buttons.forEach(setRandomStartPosition);

    buttons.forEach((button) => {
      let delay = randomBetween(0, 15000);

      setTimeout(() => {
        setInterval(() => {
          moveButtonDown(button);
        }, 16);
      }, delay);
    });
  },
  beforeDestroy() {
    location.reload();
  },

  methods: {
    playIntro() {
      this.$refs.intro.play();
      this.running = true;
    },

    pauseIntro() {
      this.$refs.intro.pause();
    },
    triggerFileInput() {
      this.$refs.gameInput.click();
    },

    loadGameFromFile() {
      const gameFile = this.$refs.gameInput.files[0];
      if (gameFile) {
        this.$refs.wasmpsxElement.readFile(gameFile);
      } else {
        console.warn("No game file selected");
        this.running = false;
      }
    },

    startEmulator() {
      this.intro = false;
      this.loadGameFromFile();

      if (window.AudioContext || window.webkitAudioContext) {
        const context = new (window.AudioContext ||
          window.webkitAudioContext)();
        if (context.state === "suspended") {
          context
            .resume()
            .then(() => {
              console.log("AudioContext resumed successfully");
            })
            .catch((error) => {
              console.error("Failed to resume AudioContext:", error);
            });
        }
      }
    },
  },
};
</script>

<style scoped>
.intro {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 15;
}
.screen {
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
  z-index: 10;
}
.sony-Div {
  position: relative;
  display: flex;
}
.sony {
    position: absolute;   /* Changed to absolute positioning */
    top: 0%;           /* Instead of margin-top */
    left: 0%;             /* Instead of margin-left */
    opacity: 0.7;         /* Opacity should be between 0 and 1 */
    max-width: 40%;
    z-index: 1;
    transform: rotate(-17deg);
    -webkit-box-reflect: below 10px
        linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.4));
}
#ps1Screen {
  display: flex;
  justify-content: center;
  height: 100%;
  width: 100%;
  position: relative;
}
.floating-button {
  position: absolute;
  width: 50px;
  opacity: 0.7;
  top: -60px;
  z-index: 5;
}
#ps1overlayOff {
  display: flex;
  justify-content: center;
  left: 50%;
  transform: translateX(-50%) translateY(-97%);
  max-width: 900px;
  border-radius: 20px;
  z-index: 7;
  position: absolute;
}
#ps1overlayOn {
  display: flex;
  justify-content: center;
  left: 50%;
  transform: translateX(-50%) translateY(-97%);
  max-width: 900px;
  border-radius: 20px;
  z-index: 7;
  position: absolute;
}
#tagline {
  display: flex;
  position: relative;
  top: 40px;
  z-index: 7;
  left: 0%;
  font-size: 3rem;
  font-family: "playstation";
  -webkit-box-reflect: below 10px
    linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.4));
}
@font-face {
  font-family: "playstation"; /* A name to be used later */
  src: url("~@/assets/customFonts/EmotionEngine.ttf") format("truetype");
  font-weight: normal; /* or bold, etc. */
  font-style: normal; /* or italic, etc. */
}
.overlay-Div {
  position: relative;
}
.button-Div {
  position: absolute;
  bottom: 10%;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  justify-content: space-between;
  width: 875px;
  z-index: 12;
}
#ps1Buttons {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
#power {
  position: relative;
  top: -5px;
  width: 86px;
  height: 82px;
  border-radius: 50%;
  background: linear-gradient(to top, #2a2a2a, #b5b5b5);
  color: #00ac9f;
  text-shadow: -1px -1px 0 #00676a, 1px -1px 0 #00676a, -1px 1px 0 #00676a,
    1px 1px 0 #00676a;
}
#load {
  width: 84px;
  height: 85px;
  border-radius: 50%;
  background: linear-gradient(to top, #2a2a2a, #b5b5b5);
  color: #5a8ccf;
  text-shadow: -1px -1px 0 #1b3a5a, 1px -1px 0 #1b3a5a, -1px 1px 0 #1b3a5a,
    1px 1px 0 #1b3a5a;
}
#message{
  display: flex;
  position: absolute;
  outline: #b5b5b5;
  background-color: #2a2a2a;
  top: 15%;
  right: 3%;
  max-width: 50%;
  border-radius: 5px;
  flex-direction: column;
  align-items: center;      /* This centers the content horizontally. */
  justify-content: center;
  z-index: 0;
}
.tips{
  font-size: 1.15rem;
  font-family: "playstation";
  opacity: 60%;
}
</style>